CREATE DATABASE tp_insta;
USE tp_insta;

CREATE TABLE utilisateur(
    id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    nom VARCHAR (50) NOT NULL, 
    prenom VARCHAR (50) NOT NULL, 
    username VARCHAR (50) NOT NULL UNIQUE,
    adresse_mail VARCHAR (50) NOT NULL UNIQUE,
    avatar VARCHAR (100) NOT NULL
);

CREATE TABLE photo(
    id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    url_image VARCHAR (100),
    id_user INT NOT NULL,
    FOREIGN KEY (id_user) REFERENCES utilisateur(id) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE likes(
    id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    id_user INT,
    FOREIGN KEY (id_user) REFERENCES utilisateur(id) ON UPDATE CASCADE ON DELETE SET NULL,
    id_photo INT NOT NULL, 
    FOREIGN KEY (id_photo) REFERENCES photo(id) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE commentaire(
    id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    id_user INT NOT NULL,
    FOREIGN KEY (id_user) REFERENCES utilisateur(id) ON UPDATE CASCADE ON DELETE CASCADE,
    id_photo INT NOT NULL, 
    FOREIGN KEY (id_photo) REFERENCES photo(id) ON UPDATE CASCADE ON DELETE CASCADE,
    contenu VARCHAR (100)
);





insert into commentaire (id, id_user, id_photo, contenu ) values (1, 16, 15, 'nibh fusce lacus purus aliquet at feugiat non');
insert into commentaire (id, id_user, id_photo, contenu ) values (2, 17, 33, 'non interdum in ante vestibulum ante ipsum primis in');
insert into commentaire (id, id_user, id_photo, contenu ) values (3, 15, 34, 'ultrices vel augue vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere');
insert into commentaire (id, id_user, id_photo, contenu ) values (4, 8, 28, 'fermentum justo nec condimentum neque');
insert into commentaire (id, id_user, id_photo, contenu ) values (5, 8, 44, 'pede ac diam cras pellentesque volutpat dui maecenas tristique est et tempus semper');
insert into commentaire (id, id_user, id_photo, contenu ) values (6, 6, 51, 'massa volutpat convallis morbi odio odio elementum eu');
insert into commentaire (id, id_user, id_photo, contenu ) values (7, 2, 48, 'id ornare imperdiet sapien urna pretium nisl');
insert into commentaire (id, id_user, id_photo, contenu ) values (8, 1, 49, 'luctus rutrum nulla tellus in sagittis dui vel nisl duis ac');
insert into commentaire (id, id_user, id_photo, contenu ) values (9, 16, 8, 'convallis duis consequat dui nec nisi volutpat eleifend');
insert into commentaire (id, id_user, id_photo, contenu ) values (10, 5, 38, 'mattis pulvinar nulla pede ullamcorper augue');
insert into commentaire (id, id_user, id_photo, contenu ) values (11, 2, 57, 'ut erat id mauris vulputate elementum nullam varius nulla facilisi');
insert into commentaire (id, id_user, id_photo, contenu ) values (12, 20, 54, 'praesent lectus vestibulum quam sapien varius ut');
insert into commentaire (id, id_user, id_photo, contenu ) values (13, 13, 14, 'magna at nunc commodo placerat praesent blandit nam nulla integer pede justo');
insert into commentaire (id, id_user, id_photo, contenu ) values (14, 19, 53, 'cursus id turpis integer aliquet');
insert into commentaire (id, id_user, id_photo, contenu ) values (15, 16, 17, 'rutrum nulla nunc purus phasellus');
insert into commentaire (id, id_user, id_photo, contenu ) values (16, 2, 29, 'dictumst maecenas ut massa quis augue luctus tincidunt nulla');
insert into commentaire (id, id_user, id_photo, contenu ) values (17, 12, 60, 'nec molestie sed justo pellentesque viverra pede ac diam cras');
insert into commentaire (id, id_user, id_photo, contenu ) values (18, 10, 3, 'sit amet eleifend pede libero quis orci');
insert into commentaire (id, id_user, id_photo, contenu ) values (19, 3, 51, 'venenatis tristique fusce congue diam id ornare');
insert into commentaire (id, id_user, id_photo, contenu ) values (20, 19, 51, 'magna ac consequat metus sapien ut nunc');
insert into commentaire (id, id_user, id_photo, contenu ) values (21, 16, 14, 'cubilia curae donec pharetra magna vestibulum aliquet ultrices erat tortor');
insert into commentaire (id, id_user, id_photo, contenu ) values (22, 14, 19, 'primis in faucibus orci luctus et ultrices posuere cubilia curae nulla dapibus');
insert into commentaire (id, id_user, id_photo, contenu ) values (23, 15, 25, 'turpis eget elit sodales scelerisque mauris');
insert into commentaire (id, id_user, id_photo, contenu ) values (24, 10, 13, 'pellentesque volutpat dui maecenas tristique est et tempus semper est quam');
insert into commentaire (id, id_user, id_photo, contenu ) values (25, 4, 3, 'ipsum dolor sit amet consectetuer adipiscing');
insert into commentaire (id, id_user, id_photo, contenu ) values (26, 3, 7, 'pede lobortis ligula sit amet eleifend pede libero');
insert into commentaire (id, id_user, id_photo, contenu ) values (27, 6, 51, 'velit id pretium iaculis diam erat fermentum justo nec condimentum neque sapien placerat ante');
insert into commentaire (id, id_user, id_photo, contenu ) values (28, 18, 56, 'sapien cursus vestibulum proin eu mi nulla ac enim');
insert into commentaire (id, id_user, id_photo, contenu ) values (29, 18, 57, 'orci luctus et ultrices posuere cubilia curae');
insert into commentaire (id, id_user, id_photo, contenu ) values (30, 2, 42, 'morbi a ipsum integer a nibh in quis justo maecenas rhoncus aliquam lacus morbi');
insert into commentaire (id, id_user, id_photo, contenu ) values (31, 16, 9, 'eget rutrum at lorem integer tincidunt ante vel ipsum praesent blandit lacinia erat vestibulum');
insert into commentaire (id, id_user, id_photo, contenu ) values (32, 6, 16, 'nec molestie sed justo pellentesque viverra');
insert into commentaire (id, id_user, id_photo, contenu ) values (33, 14, 50, 'nulla elit ac nulla sed vel enim sit amet nunc viverra dapibus nulla suscipit');
insert into commentaire (id, id_user, id_photo, contenu ) values (34, 3, 22, 'at velit eu est congue elementum in');
insert into commentaire (id, id_user, id_photo, contenu ) values (35, 16, 35, 'dui vel nisl duis ac nibh fusce lacus purus aliquet at feugiat non pretium quis');
insert into commentaire (id, id_user, id_photo, contenu ) values (36, 4, 21, 'massa volutpat convallis morbi odio odio elementum eu');
insert into commentaire (id, id_user, id_photo, contenu ) values (37, 16, 58, 'iaculis justo in hac habitasse platea dictumst etiam faucibus cursus');
insert into commentaire (id, id_user, id_photo, contenu ) values (38, 7, 19, 'in congue etiam justo etiam');
insert into commentaire (id, id_user, id_photo, contenu ) values (39, 2, 31, 'maecenas tincidunt lacus at velit vivamus vel nulla eget eros elementum pellentesque quisque');
insert into commentaire (id, id_user, id_photo, contenu ) values (40, 2, 25, 'adipiscing molestie hendrerit at vulputate vitae nisl aenean lectus');

--4. Pour tous les commentaires, montrer le contenu et le username de l'auteur 

 SELECT utilisateur.username, commentaire.contenu FROM commentaire JOIN utilisateur 
 ON utilisateur.id=commence.id_user;
 
--5. Pour chaque commentaire, afficher son contenu et url de la photo sur lequel le commentaire a été ajouté
SELECT commentaire.contenu, photo.url_image FROM commentaire JOIN photo 
ON photo.id=commentaire.id_photo;

--6. Afficher l'url de chaque photo et username de l'auteur 
SELECT utilisateur.username, photo.url_image FROM photo JOIN utilisateur
ON utilisateur.id=photo.id_user;

--7. Trouver tous les commentaires pour la photo id=3 avec username de celui qui a commenté 
SELECT utilisateur.username, commentaire.contenu, photo.id FROM commentaire 
JOIN utilisateur ON utilisateur.id=commentaire.id_user
JOIN photo ON photo.id=commentaire.id_photo 
WHERE photo.id=3;

--8. Trouver tous les url des photos ainsi que tous les commentaires qui ont été posté
-- par l'auteur de la photo 

--9. Afficher aussi nom d'utilisateur 

SELECT utilisateur.username, photo.url_image AS lien, commentaire.contenu, photo.id
FROM commentaire 
JOIN utilisateur ON utilisateur.id=commentaire.id_user
JOIN photo ON photo.id=commentaire.id_photo 
WHERE photo.id_user=commentaire.id_user; 

--10. Nb de likes pour la photo ID=4
SELECT COUNT(*) FROM likes 
JOIN photo ON likes.id_photo=photo.id
WHERE photo.id=4;